<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 7.1.2 and Furo 2024.05.06 -->
        <title>Anomaly Detection in Time Series IoT Data - Home</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/style.css?v=8a7ff5ee" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Home</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Home</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../projects/index.html">Projects</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Projects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../projects/nlp/index.html">Natural Language Processing</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Natural Language Processing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference external" href="https://www.deepakkarkala.com/docs/articles/machine_learning/airbnb_alternate_search/about/index.html">Airbnb Listing description based Semantic Search</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../projects/cv/index.html">Computer Vision</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Computer Vision</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference external" href="https://www.deepakkarkala.com/docs/articles/machine_learning/ecommerce_image_segmentation/about/index.html">Image Segmentation for Ecommerce Products</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../projects/ml/index.html">Machine Learning</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Machine Learning</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference external" href="https://www.deepakkarkala.com/docs/articles/machine_learning/airbnb_price_modeling/about/index.html">Predictive Price Modeling for Airbnb listings</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../publications/index.html">Patents, Papers, Thesis</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mlops/index.html">MLOps</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of MLOps</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../mlops/ch1_problem_framing.html">ML Problem framing</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of ML Problem framing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mlops/ch2_blueprint_operational_strategy.html">The MLOps Blueprint &amp; Operational Strategy</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lld/index.html">Low Level Design</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Low Level Design</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../lld/parking_lot.html">Parking Lot</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../visualization/index.html">Data Visualization Projects</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/past_experiences/iot_anomaly.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="anomaly-detection-in-time-series-iot-data">
<h1>Anomaly Detection in Time Series IoT Data<a class="headerlink" href="#anomaly-detection-in-time-series-iot-data" title="Permalink to this heading">¶</a></h1>
<!-- ## Anomaly Detection in Heating Energy Consumption using IoT Data for Predictive Maintenance -->
<section id="id1">
<h2><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<section id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h3>
<section id="purpose">
<h4>Purpose<a class="headerlink" href="#purpose" title="Permalink to this heading">¶</a></h4>
<p>This document provides detailed technical information about the Machine Learning (ML) based Anomaly Detection system. It serves as a guide for developers, MLOps engineers, and operations teams involved in maintaining, operating, and further developing the system.</p>
</section>
<section id="business-goal">
<h4>Business Goal<a class="headerlink" href="#business-goal" title="Permalink to this heading">¶</a></h4>
<p>The primary goal is to transition from reactive to predictive maintenance for apartment heating systems. By detecting anomalies indicative of potential malfunctions <em>before</em> they cause resident discomfort or system failure, the system aims to:</p>
<ul class="simple">
<li><p>Reduce operational costs associated with emergency maintenance.</p></li>
<li><p>Optimize maintenance scheduling and resource allocation.</p></li>
<li><p>Improve heating system reliability and uptime.</p></li>
<li><p>Enhance overall resident satisfaction.</p></li>
</ul>
</section>
<section id="key-technologies">
<h4>Key Technologies<a class="headerlink" href="#key-technologies" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>Cloud Platform:</strong> AWS (Amazon Web Services)</p></li>
<li><p><strong>Data Lake:</strong> Amazon S3</p></li>
<li><p><strong>Data Processing/ETL:</strong> AWS Glue (PySpark), AWS Lambda (Python), SageMaker Processing Jobs (PySpark/Scikit-learn)</p></li>
<li><p><strong>Feature Management:</strong> Amazon SageMaker Feature Store (Offline Store)</p></li>
<li><p><strong>Model Training:</strong> Amazon SageMaker Training Jobs (using custom Docker containers)</p></li>
<li><p><strong>Model Inference:</strong> Amazon SageMaker Batch Transform</p></li>
<li><p><strong>Model Registry:</strong> Amazon SageMaker Model Registry</p></li>
<li><p><strong>Orchestration:</strong> AWS Step Functions</p></li>
<li><p><strong>Scheduling:</strong> Amazon EventBridge Scheduler</p></li>
<li><p><strong>Alert Storage:</strong> Amazon DynamoDB</p></li>
<li><p><strong>Infrastructure as Code:</strong> Terraform</p></li>
<li><p><strong>CI/CD:</strong> Bitbucket Pipelines</p></li>
<li><p><strong>Containerization:</strong> Docker</p></li>
<li><p><strong>Core Libraries:</strong> PySpark, Pandas, Scikit-learn, Boto3, Joblib, PyYAML</p></li>
</ul>
</section>
</section>
<section id="table-of-contents">
<h3>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#introduction"><span class="xref myst">Introduction</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#purpose"><span class="xref myst">Purpose</span></a></p></li>
<li><p><a class="reference internal" href="#business-goal"><span class="xref myst">Business Goal</span></a></p></li>
<li><p><a class="reference internal" href="#scope"><span class="xref myst">Scope</span></a></p></li>
<li><p><a class="reference internal" href="#key-technologies"><span class="xref myst">Key Technologies</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#discovery-and-scoping"><span class="xref myst">Discovery and Scoping</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#use-case-evaluation"><span class="xref myst">Use Case Evaluation</span></a></p></li>
<li><p><a class="reference internal" href="#product-strategies"><span class="xref myst">Product Strategies</span></a></p></li>
<li><p><a class="reference internal" href="#features"><span class="xref myst">Features</span></a></p></li>
<li><p><a class="reference internal" href="#product-requirements-document"><span class="xref myst">Product Requirements Document</span></a></p></li>
<li><p><a class="reference internal" href="#milestones-and-timelines"><span class="xref myst">Milestones and Timelines</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#system-architecture"><span class="xref myst">System Architecture</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#overall-data-flow"><span class="xref myst">Overall Data Flow</span></a></p></li>
<li><p><a class="reference internal" href="#training-workflow-diagram"><span class="xref myst">Training Workflow Diagram</span></a></p></li>
<li><p><a class="reference internal" href="#inference-workflow-diagram"><span class="xref myst">Inference Workflow Diagram</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#challenges-and-learnings"><span class="xref myst">Challenges and learnings</span></a></p></li>
<li><p><a class="reference internal" href="#configuration-management"><span class="xref myst">Configuration Management</span></a></p></li>
<li><p><a class="reference internal" href="#infrastructure-as-code-terraform"><span class="xref myst">Infrastructure as Code (Terraform)</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#stacks-overview"><span class="xref myst">Stacks Overview</span></a></p></li>
<li><p><a class="reference internal" href="#key-resources"><span class="xref myst">Key Resources</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cost-analysis"><span class="xref myst">Cost Analysis</span></a></p></li>
<li><p><a class="reference internal" href="#cicd-pipeline-bitbucket"><span class="xref myst">CI/CD Pipeline (Bitbucket)</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#ci-workflow"><span class="xref myst">CI Workflow</span></a></p></li>
<li><p><a class="reference internal" href="#training-cd-workflow"><span class="xref myst">Training CD Workflow</span></a></p></li>
<li><p><a class="reference internal" href="#inference-cd-workflow"><span class="xref myst">Inference CD Workflow</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#deployment--execution"><span class="xref myst">Deployment &amp; Execution</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#prerequisites"><span class="xref myst">Prerequisites</span></a></p></li>
<li><p><a class="reference internal" href="#initial-deployment"><span class="xref myst">Initial Deployment</span></a></p></li>
<li><p><a class="reference internal" href="#running-training"><span class="xref myst">Running Training</span></a></p></li>
<li><p><a class="reference internal" href="#running-inference"><span class="xref myst">Running Inference</span></a></p></li>
<li><p><a class="reference internal" href="#model-approval"><span class="xref myst">Model Approval</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#monitoring--alerting"><span class="xref myst">Monitoring &amp; Alerting</span></a></p></li>
<li><p><a class="reference internal" href="#troubleshooting-guide"><span class="xref myst">Troubleshooting Guide</span></a></p></li>
<li><p><a class="reference internal" href="#security-considerations"><span class="xref myst">Security Considerations</span></a></p></li>
<li><p><a class="reference internal" href="#roadmap--future-enhancements"><span class="xref myst">Roadmap &amp; Future Enhancements</span></a></p></li>
<li><p><a class="reference internal" href="#appendices"><span class="xref myst">Appendices</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#configuration-file-example"><span class="xref myst">Configuration File Example</span></a></p></li>
</ul>
</li>
</ol>
</section>
<section id="discovery-and-scoping">
<h3>Discovery and Scoping<a class="headerlink" href="#discovery-and-scoping" title="Permalink to this heading">¶</a></h3>
<section id="use-case-evaluation">
<h4>Use Case Evaluation<a class="headerlink" href="#use-case-evaluation" title="Permalink to this heading">¶</a></h4>
<p><img alt="" src="_static/past_experiences/iot_anomaly/use_case.png" /></p>
</section>
<section id="product-strategies">
<h4>Product Strategies<a class="headerlink" href="#product-strategies" title="Permalink to this heading">¶</a></h4>
<p><img alt="" src="_static/past_experiences/iot_anomaly/strategy.png" /></p>
</section>
<section id="features">
<h4>Features<a class="headerlink" href="#features" title="Permalink to this heading">¶</a></h4>
<p><img alt="" src="_static/past_experiences/iot_anomaly/features.png" /></p>
</section>
<section id="product-requirements-document">
<h4>Product Requirements Document<a class="headerlink" href="#product-requirements-document" title="Permalink to this heading">¶</a></h4>
<p><img alt="" src="_static/past_experiences/iot_anomaly/prd.png" /></p>
</section>
<section id="development-stages">
<h4>Development Stages<a class="headerlink" href="#development-stages" title="Permalink to this heading">¶</a></h4>
<!--![](../_static/past_experiences/iot_anomaly/stages.png)-->
<p align="center">
    <img src="../_static/past_experiences/iot_anomaly/stages.png" width="60%"> 
</p>
</section>
<section id="milestones-and-timelines">
<h4>Milestones and Timelines<a class="headerlink" href="#milestones-and-timelines" title="Permalink to this heading">¶</a></h4>
<p><img alt="" src="_static/past_experiences/iot_anomaly/sprint.png" /></p>
</section>
</section>
<section id="system-architecture">
<h3>System Architecture<a class="headerlink" href="#system-architecture" title="Permalink to this heading">¶</a></h3>
<section id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h4>
<p>The system follows a modular, event-driven, and batch-oriented architecture on AWS. It consists of distinct pipelines for data ingestion, model training, and daily inference. Orchestration relies heavily on AWS Step Functions, with SageMaker providing core ML capabilities.</p>
<!--![](../_static/past_experiences/iot_anomaly/pipelines.png)-->
<p align="center">
	<img src="../_static/past_experiences/iot_anomaly/pipelines.png" width="50%"> 
</p>
</section>
<section id="data-flow">
<h4>Data Flow<a class="headerlink" href="#data-flow" title="Permalink to this heading">¶</a></h4>
<p>[TODO: Overall System Architecture and Pipelines]</p>
<ol class="arabic simple">
<li><p><strong>Raw Data:</strong> Meter, Weather, Topology data lands in the S3 Raw Zone.</p></li>
<li><p><strong>Processed Data:</strong> The Ingestion pipeline processes raw data into a structured, partitioned format (Parquet) in the S3 Processed Zone and updates the Glue Data Catalog.</p></li>
<li><p><strong>Features:</strong> The Training pipeline’s Feature Engineering step reads processed data, calculates features, and ingests them into the SageMaker Feature Store Offline Store (S3). The Inference pipeline recalculates features for the target date using shared logic.</p></li>
<li><p><strong>Model Artifacts:</strong> Training jobs output serialized model objects (<code class="docutils literal notranslate"><span class="pre">model.tar.gz</span></code>) to S3.</p></li>
<li><p><strong>Evaluation Reports:</strong> Evaluation jobs output metrics (JSON) to S3.</p></li>
<li><p><strong>Model Packages:</strong> Approved models are registered in the SageMaker Model Registry.</p></li>
<li><p><strong>Inference Scores:</strong> Batch Transform jobs read inference features and write raw anomaly scores to S3.</p></li>
<li><p><strong>Alerts:</strong> The final inference step processes scores and writes alerts to DynamoDB.</p></li>
</ol>
</section>
<section id="ingestion-workflow">
<h4>Ingestion Workflow<a class="headerlink" href="#ingestion-workflow" title="Permalink to this heading">¶</a></h4>
<p>The Ingestion pipeline processes raw data into a structured, partitioned format (Parquet) in the S3 Processed Zone and updates the Glue Data Catalog.</p>
<ul class="simple">
<li><p><strong>Responsibility:</strong> Separate pipeline/process</p></li>
<li><p><strong>Output:</strong> Partitioned Parquet data with corresponding Glue Data Catalog tables.</p></li>
</ul>
<!--![](../_static/past_experiences/iot_anomaly/why_glue.png)-->
<p align="center">
	<img src="../_static/past_experiences/iot_anomaly/why_glue.png" width="50%"> 
</p>
</section>
<section id="training-workflow">
<h4>Training Workflow<a class="headerlink" href="#training-workflow" title="Permalink to this heading">¶</a></h4>
<p><strong>Summary:</strong> Triggered manually or by CI/CD/schedule -&gt; Validates Schema -&gt; Engineers Features (to Feature Store) -&gt; Trains Model (using custom container) -&gt; Evaluates Model -&gt; Conditionally Registers Model (Pending Approval).</p>
<p>[TODO: Training Pipeline]</p>
<ol class="arabic simple">
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">ValidateSchema</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> SageMaker Processing Job (Spark)</p></li>
<li><p><strong>Action:</strong> Reads sample/metadata from <code class="docutils literal notranslate"><span class="pre">processed_meter_data</span></code> for the input date range. Compares schema against predefined definition. Fails workflow on critical mismatch.</p></li>
</ul>
</li>
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">FeatureEngineering</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> SageMaker Processing Job (Spark) / AWS Glue ETL Job</p></li>
<li><p><strong>Action:</strong> Reads <code class="docutils literal notranslate"><span class="pre">processed_meter_data</span></code> and <code class="docutils literal notranslate"><span class="pre">processed_weather_data</span></code> for input date range. Calculates features (aggregations, lags, rolling windows, joins). Ingests features into SageMaker Feature Store (<code class="docutils literal notranslate"><span class="pre">ad-apartment-features</span></code> group).</p></li>
</ul>
</li>
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">ModelTraining</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> SageMaker Training Job</p></li>
<li><p><strong>Action:</strong> Reads features for the training period from Feature Store Offline S3 location. Instantiates selected model strategy (e.g., <code class="docutils literal notranslate"><span class="pre">LR_LOF_Model</span></code>). Fits model components (Scaler, LR, LOF). Saves fitted artifacts as <code class="docutils literal notranslate"><span class="pre">model.joblib</span></code> within <code class="docutils literal notranslate"><span class="pre">model.tar.gz</span></code> to S3 output path.</p></li>
</ul>
</li>
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">ModelEvaluation</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> SageMaker Processing Job (Python/Scikit-learn)</p></li>
<li><p><strong>Action:</strong> Loads <code class="docutils literal notranslate"><span class="pre">model.tar.gz</span></code> artifact. Reads evaluation features (hold-out set) from Feature Store Offline S3 location. Calculates performance metrics (e.g., backtesting precision/recall if labels available, score distributions). Estimates training throughput. Writes <code class="docutils literal notranslate"><span class="pre">evaluation_report.json</span></code> to S3.</p></li>
</ul>
</li>
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">CheckEvaluation</span></code> (Choice)</p>
<ul class="simple">
<li><p><strong>Service:</strong> Step Functions Choice State</p></li>
<li><p><strong>Action:</strong> Compares key metrics from <code class="docutils literal notranslate"><span class="pre">evaluation_report.json</span></code> (requires parsing, possibly via an intermediate Lambda) against configured thresholds. Transitions to <code class="docutils literal notranslate"><span class="pre">RegisterModelLambda</span></code> or <code class="docutils literal notranslate"><span class="pre">EvaluationFailed</span></code>.</p></li>
</ul>
</li>
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">RegisterModelLambda</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> AWS Lambda</p></li>
<li><p><strong>Action:</strong> Reads evaluation report URI and model artifact URI from state. Gathers metadata (git hash, params, metrics, data lineage). Creates a new Model Package version in the target SageMaker Model Package Group with status <code class="docutils literal notranslate"><span class="pre">PendingManualApproval</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Terminal States:</strong> <code class="docutils literal notranslate"><span class="pre">WorkflowSucceeded</span></code>, <code class="docutils literal notranslate"><span class="pre">EvaluationFailed</span></code>, <code class="docutils literal notranslate"><span class="pre">WorkflowFailed</span></code>.</p></li>
</ol>
</section>
<section id="inference-workflow">
<h4>Inference Workflow<a class="headerlink" href="#inference-workflow" title="Permalink to this heading">¶</a></h4>
<p>[TODO: Training Pipeline]</p>
<ol class="arabic simple">
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">GetApprovedModelPackage</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> AWS Lambda</p></li>
<li><p><strong>Action:</strong> Queries SageMaker Model Registry for the latest Model Package with <code class="docutils literal notranslate"><span class="pre">Approved</span></code> status in the configured group. Returns its ARN. Fails if none found.</p></li>
</ul>
</li>
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">CreateModelResource</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> AWS Lambda</p></li>
<li><p><strong>Action:</strong> Creates a SageMaker <code class="docutils literal notranslate"><span class="pre">Model</span></code> resource using the approved Model Package ARN from the previous step and a unique name. This <code class="docutils literal notranslate"><span class="pre">Model</span></code> resource links the artifacts and container for Batch Transform. Returns the created <code class="docutils literal notranslate"><span class="pre">ModelName</span></code>.</p></li>
</ul>
</li>
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">FeatureEngineeringInference</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> SageMaker Processing Job (Spark) / AWS Glue ETL Job</p></li>
<li><p><strong>Action:</strong> Reads processed data for the inference date + lookback period. Calculates features using the <em>exact same logic</em> as training feature engineering. Outputs features (e.g., CSV format without headers) required by the model to a unique S3 path for this execution.</p></li>
</ul>
</li>
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">BatchTransform</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> SageMaker Batch Transform Job</p></li>
<li><p><strong>Action:</strong> Uses the <code class="docutils literal notranslate"><span class="pre">ModelName</span></code> created earlier. SageMaker launches the container, mounts the model artifact to <code class="docutils literal notranslate"><span class="pre">/opt/ml/model</span></code>, and provides input features from S3. The script loads the model, generates anomaly scores, and outputs scores (e.g., CSV format with identifiers and scores) to the specified S3 output path.</p></li>
</ul>
</li>
<li><p><strong>State:</strong> <code class="docutils literal notranslate"><span class="pre">ProcessResults</span></code></p>
<ul class="simple">
<li><p><strong>Service:</strong> AWS Lambda</p></li>
<li><p><strong>Action:</strong> Triggered after Batch Transform. Reads raw score files from the S3 output path. Applies the configured alert threshold. Formats alert data (ApartmentID, Date, Score, Status=’Unseen’, etc.). Writes alerts to the DynamoDB Alert Table using <code class="docutils literal notranslate"><span class="pre">BatchWriteItem</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Terminal States:</strong> <code class="docutils literal notranslate"><span class="pre">WorkflowSucceeded</span></code>, <code class="docutils literal notranslate"><span class="pre">WorkflowFailed</span></code>.</p></li>
</ol>
</section>
</section>
<section id="challenges-and-learnings">
<h3>Challenges and learnings<a class="headerlink" href="#challenges-and-learnings" title="Permalink to this heading">¶</a></h3>
<p><img alt="" src="_static/past_experiences/iot_anomaly/challenges1.png" /></p>
<p><img alt="" src="_static/past_experiences/iot_anomaly/challenges2.png" /></p>
<p><img alt="" src="_static/past_experiences/iot_anomaly/challenges3.png" /></p>
</section>
<section id="configuration-management">
<h3>Configuration Management<a class="headerlink" href="#configuration-management" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Primary Method:</strong> Version-controlled configuration files (e.g., <code class="docutils literal notranslate"><span class="pre">config/ad_config.yaml</span></code>) stored in Git. These define non-sensitive parameters like hyperparameters, feature lists, thresholds, instance types.</p></li>
<li><p><strong>Distribution:</strong> Config files are uploaded to a designated S3 location (e.g., <code class="docutils literal notranslate"><span class="pre">s3://[scripts-bucket]/config/</span></code>) by the CI/CD pipeline.</p></li>
<li><p><strong>Loading:</strong> Scripts (Glue, SM Processing, Lambda) receive the S3 URI of the relevant config file via an environment variable (<code class="docutils literal notranslate"><span class="pre">CONFIG_S3_URI</span></code>) or argument. They use <code class="docutils literal notranslate"><span class="pre">boto3</span></code> to download and parse the file at runtime. Libraries like <code class="docutils literal notranslate"><span class="pre">PyYAML</span></code> are needed.</p></li>
<li><p><strong>Runtime Overrides:</strong> Step Function inputs or job arguments can override specific parameters from the config file for execution-specific needs (e.g., <code class="docutils literal notranslate"><span class="pre">inference_date</span></code>, experimental hyperparameters).</p></li>
<li><p><strong>Secrets:</strong> Sensitive information MUST be stored in AWS Secrets Manager or SSM Parameter Store (SecureString) and fetched by the application code using its IAM role. Do NOT store secrets in Git config files.</p></li>
<li><p><strong>Environment Variables:</strong> Used primarily for passing S3 URIs (config file, data paths), resource names (table names, feature group), and potentially secrets fetched from secure stores.</p></li>
</ul>
</section>
<section id="infrastructure-as-code-terraform">
<h3>Infrastructure as Code (Terraform)<a class="headerlink" href="#infrastructure-as-code-terraform" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Tool:</strong> Terraform manages all AWS infrastructure.</p></li>
<li><p><strong>State Management:</strong> Configure a remote backend (e.g., S3 with DynamoDB locking) for Terraform state files.</p></li>
<li><p><strong>Stacks:</strong> Infrastructure is divided into logical stacks:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ingestion</span></code>: S3 buckets (Raw, Processed), Glue DB/Tables, Ingestion Glue Job, associated IAM roles.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">training</span></code>: S3 buckets (Scripts, Artifacts, Reports - potentially reused/shared), ECR Repo, Feature Group, Model Package Group, specific IAM roles, Lambdas (Register Model), Step Function (<code class="docutils literal notranslate"><span class="pre">ADTrainingWorkflow</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inference</span></code>: DynamoDB Table (Alerts), specific IAM roles, Lambdas (Get Model, Create Model, Process Results), Step Function (<code class="docutils literal notranslate"><span class="pre">ADInferenceWorkflow</span></code>), EventBridge Scheduler.</p></li>
</ul>
</li>
<li><p><strong>Variables &amp; Outputs:</strong> Stacks use input variables (defined in <code class="docutils literal notranslate"><span class="pre">variables.tf</span></code>) for configuration and expose key resource identifiers via outputs (defined in <code class="docutils literal notranslate"><span class="pre">outputs.tf</span></code>). Outputs from one stack (e.g., <code class="docutils literal notranslate"><span class="pre">processed_bucket_name</span></code> from ingestion) are passed as inputs to dependent stacks.</p></li>
</ul>
</section>
<section id="ci-cd-pipeline-bitbucket">
<h3>CI/CD Pipeline (Bitbucket)<a class="headerlink" href="#ci-cd-pipeline-bitbucket" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Tool:</strong> Bitbucket Pipelines (<code class="docutils literal notranslate"><span class="pre">bitbucket-pipelines.yml</span></code>).</p></li>
<li><p><strong>CI Workflow (Branches/PRs):</strong></p>
<ol class="arabic simple">
<li><p>Lint Python code (<code class="docutils literal notranslate"><span class="pre">flake8</span></code>).</p></li>
<li><p>Run Unit Tests (<code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">tests/unit/</span></code>).</p></li>
<li><p>Build Training/Inference Docker container.</p></li>
<li><p>Push container to AWS ECR (tagged with commit hash).</p></li>
<li><p>Validate Terraform code (<code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">validate</span></code>, <code class="docutils literal notranslate"><span class="pre">fmt</span> <span class="pre">-check</span></code>) for all stacks.</p></li>
</ol>
</li>
<li><p><strong>Training CD Workflow (<code class="docutils literal notranslate"><span class="pre">custom:deploy-and-test-ad-training</span></code>):</strong></p>
<ol class="arabic simple">
<li><p>(Manual Trigger Recommended)</p></li>
<li><p>Run CI steps (Lint, Unit Test, Build/Push).</p></li>
<li><p>Apply <code class="docutils literal notranslate"><span class="pre">training_ad</span></code> Terraform stack (using commit-specific image URI).</p></li>
<li><p>Prepare integration test data (trigger ingestion or verify pre-staged).</p></li>
<li><p>Run Training Integration Tests (<code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">tests/integration/test_training_workflow.py</span></code>).</p></li>
</ol>
</li>
<li><p><strong>Inference CD Workflow (<code class="docutils literal notranslate"><span class="pre">custom:deploy-and-test-ad-inference</span></code>):</strong></p>
<ol class="arabic simple">
<li><p>(Manual Trigger Recommended)</p></li>
<li><p>(Optional) Run CI checks.</p></li>
<li><p>Apply <code class="docutils literal notranslate"><span class="pre">inference_ad</span></code> Terraform stack.</p></li>
<li><p>Prepare integration test data (verify processed data, ensure approved model exists).</p></li>
<li><p>Run Inference Integration Tests (<code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">tests/integration/test_inference_workflow.py</span></code>).</p></li>
</ol>
</li>
<li><p><strong>Variables:</strong> Uses Bitbucket Repository Variables (CI) and Deployment Variables (CD) for AWS credentials and environment-specific parameters.</p></li>
</ul>
</section>
<section id="cost-analysis">
<h3>Cost Analysis<a class="headerlink" href="#cost-analysis" title="Permalink to this heading">¶</a></h3>
<p><img alt="" src="_static/past_experiences/iot_anomaly/cost.png" /></p>
<p><strong>Cost Optimisations</strong></p>
<ul class="simple">
<li><p>S3 Storage Dominates: The largest cost component by far is S3 storage. Implementing S3 Lifecycle policies to move older raw/processed data or feature versions to cheaper tiers (like Intelligent-Tiering or Glacier) is crucial for long-term cost management.</p></li>
<li><p>Compute is Relatively Low: The actual compute cost for running the training jobs weekly is quite low with these assumptions.</p></li>
<li><p>Assumptions Matter: If your training jobs run much longer, use more instances, or run more frequently, the SageMaker costs will increase proportionally. If your data volume is significantly larger, S3 costs increase.</p></li>
<li><p>Spot Instances: For SageMaker Processing and Training Jobs, using Spot Instances can potentially save up to 90% on compute costs, but requires designing the jobs to handle potential interruptions (checkpointing for Training, stateless design for Processing). This could significantly reduce the ~$1.45 compute estimate.</p></li>
<li><p>Instance Selection: Choosing the right instance type (e.g., ml.t3.medium for less demanding tasks can optimize compute cost.</p></li>
</ul>
</section>
<section id="deployment-execution">
<h3>Deployment &amp; Execution<a class="headerlink" href="#deployment-execution" title="Permalink to this heading">¶</a></h3>
<p><strong>Initial Deployment:</strong></p>
<ol class="arabic simple">
<li><p>Configure AWS credentials locally/in CI runner.</p></li>
<li><p>Configure Bitbucket variables (Repository &amp; Deployment).</p></li>
<li><p>Create <code class="docutils literal notranslate"><span class="pre">terraform.tfvars</span></code> files for each stack (<code class="docutils literal notranslate"><span class="pre">ingestion</span></code>, <code class="docutils literal notranslate"><span class="pre">training</span></code>, <code class="docutils literal notranslate"><span class="pre">inference</span></code>) providing required inputs (unique suffixes, potentially outputs from previous stacks).</p></li>
<li><p>Deploy Terraform stacks <strong>in order</strong>: <code class="docutils literal notranslate"><span class="pre">ingestion</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">training</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">inference</span></code>. Run <code class="docutils literal notranslate"><span class="pre">init</span></code>, <code class="docutils literal notranslate"><span class="pre">plan</span></code>, <code class="docutils literal notranslate"><span class="pre">apply</span></code> for each.</p></li>
<li><p>Build and push the initial Docker training/inference container to the ECR repository created by <code class="docutils literal notranslate"><span class="pre">training</span></code>. Ensure the <code class="docutils literal notranslate"><span class="pre">training_image_uri</span></code> variable used by Terraform deployments points to this image.</p></li>
<li><p>Place initial configuration files (<code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>) in the designated S3 config location.</p></li>
<li><p>Prepare initial raw data and run the Ingestion Glue job once to populate the processed data zone.</p></li>
</ol>
<p><strong>Running Training:</strong></p>
<ul class="simple">
<li><p>Trigger the <code class="docutils literal notranslate"><span class="pre">ADTrainingWorkflow</span></code> Step Function manually or via its schedule.</p></li>
<li><p>Provide input JSON specifying date range, parameters, code version (via image URI/git hash).</p></li>
</ul>
<p><strong>Running Inference:</strong></p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">ADInferenceWorkflow</span></code> Step Function runs automatically based on the EventBridge schedule.</p></li>
<li><p>Ensure an <em>Approved</em> model package exists in the Model Registry for the workflow to succeed.</p></li>
</ul>
<p><strong>Model Approval:</strong></p>
<ul class="simple">
<li><p>After a successful <em>Training</em> run, navigate to SageMaker -&gt; Model Registry -&gt; Model Package Groups -&gt; [Your AD Group].</p></li>
<li><p>Select the latest version (<code class="docutils literal notranslate"><span class="pre">PendingManualApproval</span></code>).</p></li>
<li><p>Review Description, Metadata, Evaluation Metrics.</p></li>
<li><p>If satisfactory, update status to <code class="docutils literal notranslate"><span class="pre">Approved</span></code>.</p></li>
</ul>
</section>
<section id="monitoring-alerting">
<h3>Monitoring &amp; Alerting<a class="headerlink" href="#monitoring-alerting" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>CloudWatch Logs:</strong> Central location for logs from Lambda, Glue, SageMaker Jobs. Implement structured logging within Python scripts for easier parsing.</p></li>
<li><p><strong>CloudWatch Metrics:</strong> Monitor key metrics:</p>
<ul>
<li><p>Step Functions: <code class="docutils literal notranslate"><span class="pre">ExecutionsFailed</span></code>, <code class="docutils literal notranslate"><span class="pre">ExecutionsTimedOut</span></code>.</p></li>
<li><p>Lambda: <code class="docutils literal notranslate"><span class="pre">Errors</span></code>, <code class="docutils literal notranslate"><span class="pre">Throttles</span></code>, <code class="docutils literal notranslate"><span class="pre">Duration</span></code>.</p></li>
<li><p>SageMaker Jobs: <code class="docutils literal notranslate"><span class="pre">CPUUtilization</span></code>, <code class="docutils literal notranslate"><span class="pre">MemoryUtilization</span></code> (if needed), Job Status (via Logs/Events).</p></li>
<li><p>DynamoDB: <code class="docutils literal notranslate"><span class="pre">ThrottledWriteRequests</span></code>, <code class="docutils literal notranslate"><span class="pre">ThrottledReadRequests</span></code>.</p></li>
</ul>
</li>
<li><p><strong>CloudWatch Alarms:</strong> <strong>REQUIRED:</strong> Set alarms on critical failure metrics (SFN <code class="docutils literal notranslate"><span class="pre">ExecutionsFailed</span></code>, Lambda <code class="docutils literal notranslate"><span class="pre">Errors</span></code>). Configure SNS topics for notifications.</p></li>
<li><p><strong>SageMaker Model Monitor (Future):</strong> Implement data quality and model quality monitoring to detect drift over time.</p></li>
<li><p><strong>Application-Level Monitoring:</strong> Track the number of alerts generated daily, processing times, etc.</p></li>
</ul>
</section>
<section id="troubleshooting-guide">
<h3>Troubleshooting Guide<a class="headerlink" href="#troubleshooting-guide" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Workflow Failure (Step Functions):</strong> Check the Step Functions execution history in the AWS Console. Identify the failed state and examine its input, output, and error message.</p></li>
<li><p><strong>Job Failures (Glue/SageMaker):</strong> Go to the corresponding CloudWatch Log Group for the failed job (links often available in Step Function state details). Look for Python exceptions or service errors. Check job metrics for resource exhaustion.</p></li>
<li><p><strong>Lambda Failures:</strong> Check the Lambda function’s CloudWatch Log Group. Look for errors, timeouts, or permission issues. Verify environment variables and input payload.</p></li>
<li><p><strong>IAM Permissions:</strong> If errors indicate access denied, carefully review the IAM roles and policies associated with the failing service (SFN, Lambda, SageMaker Job roles) ensuring necessary permissions to other services (S3, SageMaker API, DynamoDB, ECR, etc.).</p></li>
<li><p><strong>Data Issues:</strong></p>
<ul class="simple">
<li><p><strong>Schema Mismatch:</strong> Check <code class="docutils literal notranslate"><span class="pre">ValidateSchema</span></code> logs. Verify Glue Catalog definition matches actual data.</p></li>
<li><p><strong>Missing Features:</strong> Ensure feature engineering script runs correctly and produces all columns needed by the model. Check Feature Store ingestion if used.</p></li>
<li><p><strong>Empty Data:</strong> Check upstream processes; ensure ingestion ran and data exists for the target dates.</p></li>
</ul>
</li>
<li><p><strong>Configuration Errors:</strong> Verify config files in S3 are correct and accessible. Check environment variables passed to jobs/lambdas.</p></li>
<li><p><strong>Model Artifact Issues:</strong> Ensure the <code class="docutils literal notranslate"><span class="pre">model.tar.gz</span></code> exists, is not corrupted, and contains all necessary files (<code class="docutils literal notranslate"><span class="pre">model.joblib</span></code>, etc.). Verify the <code class="docutils literal notranslate"><span class="pre">inference.py</span></code> script loads it correctly.</p></li>
<li><p><strong>Batch Transform Failures:</strong> Check Batch Transform job logs in CloudWatch. Common issues include container errors (script failures, dependency issues), data format errors, or IAM permission problems for the model’s execution role.</p></li>
</ol>
</section>
<section id="security-considerations">
<h3>Security Considerations<a class="headerlink" href="#security-considerations" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>IAM Least Privilege:</strong> Regularly review and tighten IAM roles assigned to Step Functions, Lambdas, Glue, and SageMaker jobs. Grant only necessary permissions.</p></li>
<li><p><strong>Data Encryption:</strong></p>
<ul>
<li><p><strong>At Rest:</strong> Enable server-side encryption (SSE-S3, SSE-KMS) on all S3 buckets. Enable encryption for DynamoDB tables. Ensure EBS volumes attached to SageMaker jobs are encrypted.</p></li>
<li><p><strong>In Transit:</strong> AWS services use TLS for communication by default. Ensure any custom external connections also use TLS.</p></li>
</ul>
</li>
<li><p><strong>Secret Management:</strong> Use AWS Secrets Manager or SSM Parameter Store (SecureString) for any sensitive credentials or API keys.</p></li>
<li><p><strong>Network Security:</strong> For enhanced security, consider deploying resources within a VPC using VPC Endpoints for AWS service access, minimizing exposure to the public internet. Configure Security Groups appropriately.</p></li>
<li><p><strong>Container Security:</strong> Regularly scan the custom Docker container image for vulnerabilities using ECR Image Scanning or third-party tools. Keep base images and libraries updated.</p></li>
<li><p><strong>Input Validation:</strong> Sanitize and validate inputs to Lambda functions and Step Function executions, especially if triggered externally.</p></li>
<li><p><strong>Access Control:</strong> Restrict access to the SageMaker Model Registry and approval workflows to authorized personnel.</p></li>
</ul>
</section>
<section id="roadmap-future-enhancements">
<h3>Roadmap &amp; Future Enhancements<a class="headerlink" href="#roadmap-future-enhancements" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Implement SageMaker Model Monitor for data quality and model drift detection.</p></li>
<li><p>Set up automated retraining triggers based on schedule or drift detection.</p></li>
<li><p>Explore more sophisticated anomaly detection algorithms (e.g., Autoencoders, Isolation Forests) via the Strategy Pattern.</p></li>
<li><p>Implement A/B testing for different model versions using SageMaker Inference Pipelines.</p></li>
<li><p>Enhance the Internal Dashboard for better alert visualization and diagnostics.</p></li>
<li><p>Integrate alerts directly with maintenance ticketing systems.</p></li>
</ul>
</section>
<section id="appendices">
<h3>Appendices<a class="headerlink" href="#appendices" title="Permalink to this heading">¶</a></h3>
<section id="data-schemas">
<h4>Data Schemas<a class="headerlink" href="#data-schemas" title="Permalink to this heading">¶</a></h4>
<p><em>(Raw Meter Data, Processed Meter Data, Weather Data, Feature Store Features, Alert Table Schema)</em></p>
</section>
<section id="configuration-file-example">
<h4>Configuration File Example<a class="headerlink" href="#configuration-file-example" title="Permalink to this heading">¶</a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">feature_engineering</span><span class="p">:</span>
<span class="w">  </span><span class="nt">lookback_days</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
<span class="w">  </span><span class="nt">weather_feature_cols</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;hdd&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;avg_temp_c&quot;</span><span class="p p-Indicator">]</span>

<span class="nt">training</span><span class="p">:</span>
<span class="w">  </span><span class="nt">model_strategy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;LR_LOF&quot;</span>
<span class="w">  </span><span class="nt">hyperparameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">lof_neighbors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">    </span><span class="nt">lof_contamination</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;auto&quot;</span>
<span class="w">  </span><span class="nt">feature_columns</span><span class="p">:</span><span class="w"> </span><span class="c1"># List of features model actually uses</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">daily_energy_kwh</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">avg_temp_diff</span>
<span class="w">    </span><span class="c1"># ... etc</span>
<span class="w">  </span><span class="nt">instance_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ml.m5.large&quot;</span>

<span class="nt">evaluation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">metrics_thresholds</span><span class="p">:</span>
<span class="w">    </span><span class="nt">min_f1_score</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.6</span><span class="w"> </span><span class="c1"># Example if using labels</span>
<span class="w">    </span><span class="nt">max_throughput_deviation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w"> </span><span class="c1"># Example</span>
<span class="w">  </span><span class="nt">holdout_data_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;s3://...&quot;</span><span class="w"> </span><span class="c1"># Path to specific eval data</span>

<span class="nt">inference</span><span class="p">:</span>
<span class="w">  </span><span class="nt">alert_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
<span class="w">  </span><span class="nt">batch_transform_instance_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ml.m5.large&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Deepak Karkala
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Anomaly Detection in Time Series IoT Data</a><ul>
<li><a class="reference internal" href="#id1"></a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#purpose">Purpose</a></li>
<li><a class="reference internal" href="#business-goal">Business Goal</a></li>
<li><a class="reference internal" href="#key-technologies">Key Technologies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li><a class="reference internal" href="#discovery-and-scoping">Discovery and Scoping</a><ul>
<li><a class="reference internal" href="#use-case-evaluation">Use Case Evaluation</a></li>
<li><a class="reference internal" href="#product-strategies">Product Strategies</a></li>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#product-requirements-document">Product Requirements Document</a></li>
<li><a class="reference internal" href="#development-stages">Development Stages</a></li>
<li><a class="reference internal" href="#milestones-and-timelines">Milestones and Timelines</a></li>
</ul>
</li>
<li><a class="reference internal" href="#system-architecture">System Architecture</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#data-flow">Data Flow</a></li>
<li><a class="reference internal" href="#ingestion-workflow">Ingestion Workflow</a></li>
<li><a class="reference internal" href="#training-workflow">Training Workflow</a></li>
<li><a class="reference internal" href="#inference-workflow">Inference Workflow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#challenges-and-learnings">Challenges and learnings</a></li>
<li><a class="reference internal" href="#configuration-management">Configuration Management</a></li>
<li><a class="reference internal" href="#infrastructure-as-code-terraform">Infrastructure as Code (Terraform)</a></li>
<li><a class="reference internal" href="#ci-cd-pipeline-bitbucket">CI/CD Pipeline (Bitbucket)</a></li>
<li><a class="reference internal" href="#cost-analysis">Cost Analysis</a></li>
<li><a class="reference internal" href="#deployment-execution">Deployment &amp; Execution</a></li>
<li><a class="reference internal" href="#monitoring-alerting">Monitoring &amp; Alerting</a></li>
<li><a class="reference internal" href="#troubleshooting-guide">Troubleshooting Guide</a></li>
<li><a class="reference internal" href="#security-considerations">Security Considerations</a></li>
<li><a class="reference internal" href="#roadmap-future-enhancements">Roadmap &amp; Future Enhancements</a></li>
<li><a class="reference internal" href="#appendices">Appendices</a><ul>
<li><a class="reference internal" href="#data-schemas">Data Schemas</a></li>
<li><a class="reference internal" href="#configuration-file-example">Configuration File Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    </body>
</html>